<!DOCTYPE html>
<html lang="en" dir="ltr">

<head>
  <meta charset="utf-8">
  <title></title>
  <style>
    body {
      padding: 32px;
      font-family: -apple-system;
      background-color: #f7f7f7;
    }

    input {
      width: calc(100% - 32px);
      height: 30px;
      font-size: 14px;
      padding: 16px;
      margin-bottom: 16px;
      border: none;
      border-radius: 10px;
      box-shadow: 0 5px 15px 0 rgba(0, 0, 0, 0.1);
    }

    button {
      background-color: #007aff;
      border: none;
      color: #fff;
      font-weight: bold;
      padding: 10px;
      padding-left: 32px;
      padding-right: 32px;
      font-size: 14px;
      border-radius: 100px;
      text-transform: uppercase;
    }
  </style>
</head>

<body style="">
  <h1>Eclipse Backup Converter</h1>
  <input type="text" name="json" placeholder="Enter file contents here" id="json" value="">
  <button onclick="convert()">Convert to new format</button>
  <script>
    var eclipse = {
      version: "2.0.0",
      methods: {
        keybindings: {
          get_char_name: function(keycode) {
            var keyboardMap = ["","","","CANCEL","","","HELP","","BACK_SPACE","TAB","","","CLEAR","ENTER","ENTER_SPECIAL","","SHIFT","CONTROL","ALT","PAUSE","CAPS_LOCK","KANA","EISU","JUNJA","FINAL","HANJA","","ESCAPE","CONVERT","NONCONVERT","ACCEPT","MODECHANGE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","LEFT","UP","RIGHT","DOWN","SELECT","PRINT","EXECUTE","PRINTSCREEN","INSERT","DELETE","","0","1","2","3","4","5","6","7","8","9","COLON","SEMICOLON","LESS_THAN","EQUALS","GREATER_THAN","QUESTION_MARK","AT","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","OS_KEY","","CONTEXT_MENU","","SLEEP","NUMPAD0","NUMPAD1","NUMPAD2","NUMPAD3","NUMPAD4","NUMPAD5","NUMPAD6","NUMPAD7","NUMPAD8","NUMPAD9","MULTIPLY","ADD","SEPARATOR","SUBTRACT","DECIMAL","DIVIDE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","","","","","","","","","NUM_LOCK","SCROLL_LOCK","WIN_OEM_FJ_JISHO","WIN_OEM_FJ_MASSHOU","WIN_OEM_FJ_TOUROKU","WIN_OEM_FJ_LOYA","WIN_OEM_FJ_ROYA","","","","","","","","","","CIRCUMFLEX","EXCLAMATION","DOUBLE_QUOTE","HASH","DOLLAR","PERCENT","AMPERSAND","UNDERSCORE","OPEN_PAREN","CLOSE_PAREN","ASTERISK","PLUS","PIPE","HYPHEN_MINUS","OPEN_CURLY_BRACKET","CLOSE_CURLY_BRACKET","TILDE","","","","","VOLUME_MUTE","VOLUME_DOWN","VOLUME_UP","","","SEMICOLON","EQUALS","COMMA","MINUS","PERIOD","SLASH","BACK_QUOTE","","","","","","","","","","","","","","","","","","","","","","","","","","","OPEN_BRACKET","BACK_SLASH","CLOSE_BRACKET","QUOTE","","META","ALTGR","","WIN_ICO_HELP","WIN_ICO_00","","WIN_ICO_CLEAR","","","WIN_OEM_RESET","WIN_OEM_JUMP","WIN_OEM_PA1","WIN_OEM_PA2","WIN_OEM_PA3","WIN_OEM_WSCTRL","WIN_OEM_CUSEL","WIN_OEM_ATTN","WIN_OEM_FINISH","WIN_OEM_COPY","WIN_OEM_AUTO","WIN_OEM_ENLW","WIN_OEM_BACKTAB","ATTN","CRSEL","EXSEL","EREOF","PLAY","ZOOM","","PA1","WIN_OEM_CLEAR",""];
            var name = keyboardMap[keycode].toLowerCase();
            return name[0].toUpperCase() + name.substr(1);
          }
        }
      }
    };

    function convert() {
      var json = JSON.parse(document.getElementById("json").value);
      if (json.eclipse != null || json.igba != null) {
        var array;
        if (json.eclipse != null) {
          array = json.eclipse;
        } else if (json.igba != null) {
          array = json.igba;
        }
        var notice =
          "Please copy the entirity of this page and create a new file with the extension \'.eclipse\'. Open the new file, and paste the copied text inside.  You will only see this page once, the next launch of Eclipse will not show this.";
        var data = "";
        for (var i = 0; i < array.length; i++) {
          if (array[i].name == "setup") {
            data += '"' + array[i].name + '":' + JSON.stringify(eclipse.version) + '';
          } else if (array[i].name == "cacheKey" || array[i].name == "google_pub_config") {} else if (array[i].name == "controls") {
            var controls_data = "\"controls\":{";
            var controls_form = "\"controls_form\":{";
            for (var ii = 0; ii < array[i].inner.controls.length; ii++) {
              controls_data += '"' + array[i].inner.controls[ii].ctrl.toLowerCase() + '":' + array[i].inner.controls[ii].keycode;
              controls_form += '"' + array[i].inner.controls[ii].ctrl.toLowerCase() + '":"' + eclipse.methods.keybindings.get_char_name(array[i].inner.controls[ii].keycode) + '"';
              if (ii != array[i].inner.controls.length - 1) {
                controls_data += ", ";
                controls_form += ", ";
              } else {
                controls_data += "}";
                controls_form += "}";
              }
            }
            data += controls_data + ", ";
            data += controls_form;
          } else {
            data += '"' + array[i].name + '":' + JSON.stringify(array[i].inner) + '';
          }
          if (array[i].name == "cacheKey" || array[i].name == "google_pub_config") {

          } else if (i != array.length - 1) {
            data += ', ';
          }
        }
        var output = '{"notice":' + JSON.stringify(notice) + ', "backup_v2": true, "eclipse":{' + data + '}}';
        // console.log(output);
        console.log(JSON.parse(output));
        alert("Check the Javascript console for the outputed JSON.");
      } else {
        alert("Not an Eclipse/iGBA Backup");
      }
    }
  </script>
</body>

</html>
