(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{230:function(e,t,r){"use strict";class n{constructor(e,t,r,n){this._name=e,this._size=t,this._path=r,this._archiveRef=n}get name(){return this._name}get size(){return this._size}extract(){return this._archiveRef.extractSingleFile(this._path)}}class a{static init(e={}){return a._options={workerUrl:"../dist/worker-bundle.js",...e},a._options}static open(e,t=null){return t=t||a._options||a.init()&&console.warn("Automatically initializing using options: ",a._options),new a(e,t).open()}constructor(e,t){this._worker=new Worker(t.workerUrl),this._worker.addEventListener("message",this._workerMsg.bind(this)),this._callbacks=[],this._content={},this._processed=0,this._file=e}async open(){return await this._postMessage({type:"HELLO"},(e,t,r)=>{"READY"===r.type&&e()}),await this._postMessage({type:"OPEN",file:this._file},(e,t,r)=>{"OPENED"===r.type&&e(this)})}hasEncryptedData(){return this._postMessage({type:"CHECK_ENCRYPTION"},(e,t,r)=>{"ENCRYPTION_STATUS"===r.type&&e(r.status)})}usePassword(e){return this._postMessage({type:"SET_PASSPHRASE",passphrase:e},(e,t,r)=>{"PASSPHRASE_STATUS"===r.type&&e(r.status)})}getFilesObject(){return this._processed>0?Promise.resolve().then(()=>this._content):this._postMessage({type:"LIST_FILES"},(e,t,r)=>{if("ENTRY"===r.type){const e=r.entry,[t,a]=this._getProp(this._content,e.path);return"FILE"===e.type&&(t[a]=new n(e.fileName,e.size,e.path,this)),!0}"END"===r.type&&(this._processed=1,e(this._cloneContent(this._content)))})}getFilesArray(){return this.getFilesObject().then(e=>this._objectToArray(e))}extractSingleFile(e){return this._postMessage({type:"EXTRACT_SINGLE_FILE",target:e},(e,t,r)=>{if("FILE"===r.type){e(new File([r.entry.fileData],r.entry.fileName,{type:"application/octet-stream"}))}})}extractFiles(e){return this._processed>1?Promise.resolve().then(()=>this._content):this._postMessage({type:"EXTRACT_FILES"},(t,r,n)=>{if("ENTRY"===n.type){const[t,r]=this._getProp(this._content,n.entry.path);return"FILE"===n.entry.type&&(t[r]=new File([n.entry.fileData],n.entry.fileName,{type:"application/octet-stream"}),void 0!==e&&setTimeout(e.bind(null,{file:t[r],path:n.entry.path}))),!0}"END"===n.type&&(this._processed=2,this._worker.terminate(),t(this._cloneContent(this._content)))})}_cloneContent(e){if(e instanceof File||e instanceof n||null===e)return e;const t={};for(const r of Object.keys(e))t[r]=this._cloneContent(e[r]);return t}_objectToArray(e,t=""){const r=[];for(const a of Object.keys(e))e[a]instanceof File||e[a]instanceof n||null===e[a]?r.push({file:e[a]||a,path:t}):r.push(...this._objectToArray(e[a],`${t}${a}/`));return r}_getProp(e,t){const r=t.split("/");""===r[r.length-1]&&r.pop();let n=e,a=null;for(const e of r)n[e]=n[e]||{},a=n,n=n[e];return[a,r[r.length-1]]}_postMessage(e,t){return this._worker.postMessage(e),new Promise((e,r)=>{this._callbacks.push(this._msgHandler.bind(this,t,e,r))})}_msgHandler(e,t,r,n){if("BUSY"===n.type)r("worker is busy");else{if("ERROR"!==n.type)return e(t,r,n);r(n.error)}}_workerMsg({data:e}){(0,this._callbacks[this._callbacks.length-1])(e)||this._callbacks.pop()}}r.d(t,"a",(function(){return a}))},64:function(e,t,r){"use strict";r.r(t),function(e){r.d(t,"default",(function(){return b}));var n=r(2),a=r.n(n),o=r(14),i=(r(50),r(230));function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function p(e,t,r,n,a,o,i){try{var s=e[o](i),c=s.value}catch(e){return void r(e)}s.done?t(c):Promise.resolve(c).then(n,a)}function m(e){return function(){var t=this,r=arguments;return new Promise((function(n,a){var o=e.apply(t,r);function i(e){p(o,n,a,i,s,"next",e)}function s(e){p(o,n,a,i,s,"throw",e)}i(void 0)}))}}function f(e){return function(e){if(Array.isArray(e)){for(var t=0,r=new Array(e.length);t<e.length;t++)r[t]=e[t];return r}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function d(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e):t}function g(e){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function y(e,t){return(y=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var b=function(t){function r(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,r),(e=d(this,g(r).call(this))).state={games:[]},e}var n,s,c,u,p,b,v;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&y(e,t)}(r,t),n=r,(s=[{key:"componentDidMount",value:function(){var t=this;i.a.init({workerUrl:"./static/libarchive/worker-bundle.js"}),e.document.querySelector(".add-game-button").addEventListener("click",(function(){return t.addButton()})),e.eclipse.games.list().then((function(e){return t.setState({games:e})}))}},{key:"componentDidUpdate",value:function(){var t=this;f(e.document.querySelectorAll(".game-card .boxart")).forEach((function(e){var r=function(e){return t.gameMenu(e)};e.removeEventListener("taphold",r),e.removeEventListener("taphold",r),e.addEventListener("taphold",r),e.addEventListener("contextmenu",r),t.$f7.lazy.loadImage(e)}))}},{key:"getFileData",value:function(e){return new Promise((function(t,r){var n=new FileReader;n.onload=function(){return t(n.result)},n.onerror=function(e){return r(e)},n.readAsBinaryString(e)}))}},{key:"handleUploadedGames",value:(v=m(regeneratorRuntime.mark((function t(r){var n,a,o,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.eclipse.openvgdb.init();case 2:return n=t.sent,t.next=5,Promise.all(r.map(function(){var e=m(regeneratorRuntime.mark((function e(t){var r,a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.$f7.utils.removeDiacritics(t.name),e.next=3,i.gameFromFileName(r,n);case 3:return a=e.sent,e.next=6,i.getFileData(t);case 6:return o=e.sent,e.abrupt("return",l({file:o},a));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 5:return a=t.sent,t.next=8,Promise.all(a.map(function(){var t=m(regeneratorRuntime.mark((function t(r){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e.eclipse.games.add(r));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 8:return this.$f7.preloader.hide(),t.next=11,e.eclipse.games.list();case 11:o=t.sent,this.setState({games:o});case 13:case"end":return t.stop()}}),t,this)}))),function(e){return v.apply(this,arguments)})},{key:"handleGameURL",value:(b=m(regeneratorRuntime.mark((function t(r){var n,a,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.eclipse.openvgdb.init();case 2:return n=r.pathname.split("/").pop(),t.next=5,this.gameFromFileName(n);case 5:return a=t.sent,console.log(a),e.eclipse.games.add(l({url:r.href},a)),this.$f7.preloader.hide(),t.next=11,e.eclipse.games.list();case 11:o=t.sent,this.setState({games:o});case 13:case"end":return t.stop()}}),t,this)}))),function(e){return b.apply(this,arguments)})},{key:"gameFromFileName",value:(p=m(regeneratorRuntime.mark((function t(r){var n,a,o,i,s,c,l=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=r.split(".").pop(),a=e.eclipse.system({fileType:n}),o=r.replace(/_/g," ").replace(/-/g," ").replace("%20"," ").replace(".".concat(n),"").toLowerCase().split(" ").map((function(e){return e.replace(/\[.*?\]/,"").replace(/\(.*?\)/,"")})).filter((function(e){return""!==e})),i="system IS ".concat(o.map((function(e){return"name LIKE '%".concat(e,"%' AND system IS '").concat(a.name.short,"'")})).join("\nOR ")),t.next=6,e.eclipse.openvgdb.run(i);case 6:if(s=t.sent,!((c=s.filter((function(e){return new RegExp("(?=.*".concat(o.join(")(?=.*"),")"),"i").test(l.$f7.utils.removeDiacritics(e.name))}))).length>0)){t.next=10;break}return t.abrupt("return",c[0]);case 10:return t.abrupt("return",{boxart:"",name:r.replace(".".concat(n),""),system:a.name.short});case 11:case"end":return t.stop()}}),t)}))),function(e){return p.apply(this,arguments)})},{key:"addButton",value:function(){var t=this,r=this.$f7;r.actions.create({buttons:[[{text:"Add Game",label:!0},{text:"Game Hub",color:"blue",onClick:function(){return t.$f7router.navigate("/game-hub/")}},{text:"URL",color:"blue",onClick:function(){r.dialog.prompt("Enter the direct URL for a game",function(){var e=m(regeneratorRuntime.mark((function e(n){var a,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a=new URL(n),r.preloader.show(),e.next=5,t.handleGameURL(a);case 5:o=e.sent,console.log(o),r.preloader.hide(),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error(e.t0),r.dialog.alert("Please enter a valid URL.");case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}())}},{text:"Files",color:"blue",onClick:function(){var r=e.eclipse.systems.flatMap((function(e){return e.fileTypes})),n=["zip","7z","rar","tar"],a=[].concat(n,f(r)).map((function(e){return".".concat(e)})).join(", "),o=e.document.createElement("input");o.setAttribute("type","file"),o.setAttribute("accept",a),o.setAttribute("multiple",!0),o.onchange=function(){var e=m(regeneratorRuntime.mark((function e(a){var o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.$f7.preloader.show(),e.next=3,Promise.all(f(a.target.files).map(function(){var e=m(regeneratorRuntime.mark((function e(t){var a,o,s,c,l,u;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=t.name.split(".").pop(),!(n.indexOf(a)>-1)){e.next=17;break}return e.next=4,i.a.open(t);case 4:return o=e.sent,e.next=7,o.getFilesArray();case 7:if(s=e.sent,!((c=s.filter((function(e){var t=e.file._name.split(".").pop();return r.indexOf(t)>-1}))).length>0)){e.next=16;break}return e.next=12,o.extractFiles();case 12:return l=e.sent,u=c.map((function(e){return l[e.file._name]})).filter((function(e){return!!e})),console.log({supported:c,supportedFiles:u,extractedFiles:l,files:s}),e.abrupt("return",u);case 16:return e.abrupt("return",null);case 17:return e.abrupt("return",t);case 18:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 3:o=e.sent,t.handleUploadedGames(o.flat());case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),o.click()}}],[{text:"Cancel",color:"blue",bold:!0}]],targetEl:e.document.querySelector(".add-game-button")}).open()}},{key:"gameMenu",value:(u=m(regeneratorRuntime.mark((function t(r){var n,a,o,i=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r.preventDefault(),console.log(r),t.next=4,e.eclipse.games.get({id:r.target.dataset.id});case 4:return n=t.sent,a=n[0],console.log(a),t.next=9,e.eclipse.system({short:a.system});case 9:o=t.sent,console.log(o),this.$f7.actions.create({buttons:[[{text:a.name,label:!0},{text:"Rename",color:"blue",onClick:function(){i.$f7.dialog.prompt('Rename "'.concat(a.name,'"'),"Eclipse",function(){var t=m(regeneratorRuntime.mark((function t(r){var n,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),(n=a).name=r,t.next=5,e.eclipse.games.update(n);case 5:return t.next=7,e.eclipse.games.list();case 7:o=t.sent,i.setState({games:o});case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),null,"".concat(a.name))}},{text:"Change Boxart",color:"blue"},{text:null!=a.url?"Edit URL":null,color:"blue",onClick:function(){i.$f7.dialog.prompt('Edit URL for "'.concat(a.name,'"'),"Eclipse",(function(e){console.log(e)}),(function(){}),"".concat(a.url))}},{text:a.file?null:"Download",color:"blue"},{text:o.methods.storeSave?"Saves":null,color:"blue"},{text:o.methods.loadCheats?"Cheats":null,color:"blue"},{text:"Delete",color:"red",onClick:function(){i.$f7.dialog.confirm("Are you sure you want to delete ".concat(a.name,"?"),m(regeneratorRuntime.mark((function t(){var r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.eclipse.games.remove(a.id);case 2:return t.next=4,e.eclipse.games.list();case 4:r=t.sent,i.setState({games:r});case 6:case"end":return t.stop()}}),t)}))))}}].filter((function(e){return!!e.text})),[{text:"Cancel",color:"blue",bold:!0}]],targetEl:r.target}).open();case 12:case"end":return t.stop()}}),t,this)}))),function(e){return u.apply(this,arguments)})},{key:"render",value:function(){var e=this.state.games;return a.a.createElement(o.r,{name:"home"},a.a.createElement(o.q,{large:!this.$theme.md,largeTransparent:!this.$theme.md,sliding:!1},a.a.createElement(o.m,null,a.a.createElement(o.h,{iconIos:"f7:bars",iconAurora:"f7:bars",iconMd:"material:menu",panelOpen:"left"})),a.a.createElement(o.o,{sliding:!0},"Library"),this.$theme.md?null:a.a.createElement(o.p,null,"Library"),a.a.createElement(o.n,null,a.a.createElement(o.h,{searchbarEnable:".search-games-library",iconIos:"f7:search",iconAurora:"f7:search",iconMd:"material:search"}),a.a.createElement(o.h,{className:"add-game-button",iconIos:"f7:plus",iconAurora:"f7:plus",iconMd:"material:add"})),a.a.createElement(o.w,{className:"search-games-library",searchContainer:".search-games-library-list",searchIn:".name",expandable:!0,disableButton:!this.$theme.aurora})),e.length>0?a.a.createElement("div",{className:"list search-games-library-list no-hairlines",style:{margin:"0px",marginBottom:"16px",padding:"0px 8px"}},a.a.createElement("ul",{className:"row no-gap",style:{backgroundColor:"transparent"}},e.map((function(e,t){return a.a.createElement(o.f,{key:t.toString(),width:"50",medium:"33",large:"25",xlarge:"20"},a.a.createElement(o.h,{href:"/game/".concat(e.id,"/play/"),style:{display:"block",color:"inherit"}},a.a.createElement(o.e,{className:"game-card",noOutline:!0,noShadow:!0},a.a.createElement("div",{className:"boxart lazy lazy-fade-in","data-id":e.id,"data-background":e.boxart?e.boxart:"static/img/default-cover.png"}),a.a.createElement("p",{className:"name"},e.name),a.a.createElement("p",{className:"system"},e.system))))})),a.a.createElement(o.f,{width:"50",medium:"33",large:"25",xlarge:"20"}),a.a.createElement(o.f,{width:"50",medium:"33",large:"25",xlarge:"20"}),a.a.createElement(o.f,{width:"50",medium:"33",large:"25",xlarge:"20"}),a.a.createElement(o.f,{width:"50",medium:"33",large:"25",xlarge:"20"}),a.a.createElement(o.f,{width:"50",medium:"33",large:"25",xlarge:"20"}))):a.a.createElement(o.s,{style:{display:"flex",justifyContent:"center",alignItems:"center",padding:"0px",height:"calc(100% - calc(var(--f7-navbar-height) + var(--f7-navbar-large-title-height)))"}},a.a.createElement(o.b,{strong:!0,inset:!0,style:{textAlign:"center",backgroundColor:"transparent"}},a.a.createElement("h1",null,"No Games"),a.a.createElement("p",null,"You can add some games to your library by pressing + in the top right corner."))))}}])&&h(n.prototype,s),c&&h(n,c),r}(a.a.Component)}.call(this,r(13))}}]);